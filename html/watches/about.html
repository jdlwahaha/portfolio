<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="icon" type="image/png" href="../../img/icon.png"/>
    <title>Watches</title>
    <link rel="stylesheet" href="../../css/animation.css">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/font-color.css">
    <link rel="stylesheet" href="../../css/box.css">
    <link rel="stylesheet" href="../../css/nav.css">
    <link rel="stylesheet" href="../../css/desktop-nav.css">
	<script src="../../lib/jquery-3.5.1.min.js"></script>
	<script src="../../js/script.js"></script>
	<script src="../../js/watches/watch.service.js"></script>
</head>

<style>
    #costSummary { 
        th, td { 
            text-align: center;
            padding: .5rem 3rem;
        }
    }

    @media (max-width: 600px) { 
        #costSummary { 
            width: 100%;

            th, td { 
                text-align: center;
                padding: inherit;
                padding-top: .5rem;
                padding-bottom: .5rem;

            }
        }
    }
</style>

<body>
	<header><!-- jQuery generated --></header>

	<section id="mainContent">
        <div id="main">
            <div class="submenu" id="submenu"><!-- watch service generated --></div>
	


			<section class="box">

                <div class="box-content">

                    <div class="well well-info no-margin">
                        To keep my spending in control and hobby collected, 
                        I need to watch my spending.
                    </div>


                    <p>

                        The prices in this section are my purchased price after tax. 
                        
                        Dates are my acquisition date. <br>
                    </p>
                    <table id="costSummary"></table>
               
                </div>
            </section>

		</div>
	
		<footer><!-- jQuery generated --></footer>
	</section>

	
</body>
</html>

<script>
(function () {


    $(document).ready(async function() { 


        let section = $.urlParam('section');
        section = 'about';
        let submenuHtml = getSubmenuHtml(section, nav);    
        $('#submenu').append(submenuHtml); 


        let grandTotal = 0;
        let numOfWatches = 0;
        let dataRows = '';
        
        let categories = await getWatches(); 

        await categories.map(async (watches, i) => {
            let total = 0;

            watches = watches.filter(i => i.purchasedPrice);

            watches.map(watch => {
                total += watch.purchasedPrice;
            });

            grandTotal += total;
            numOfWatches += watches.length;
            
            dataRows += `<tr>
                    <td>${nav[i].display}</td>
                    <td>${readablePrice(total)}</td>
                    <td>${watches.length}</td>
                </tr>`;
            return watches;
        });


        let headerRow = `<tr>
                <th>Total</th>
                <th>${readablePrice(grandTotal)}</th>
                <th>${numOfWatches}</th>
            </tr>`; 
        let html = headerRow + dataRows;
        $('#costSummary').append(html);
        $('#totalPrice').append(readablePrice(grandTotal));
        
    });
    
    async function getWatches() {
        let promises = nav.map(item =>  $.getJSON(`../../data/watches/0${item.filename}.json`));
        return Promise.all(promises);
    }
 


})();
</script>